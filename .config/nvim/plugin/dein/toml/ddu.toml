[[plugins]]
repo = 'Shougo/ddu-ui-ff'
depends = 'denops.vim'
on_source = 'ddu.vim'

[[plugins]]
repo = 'Shougo/ddu-source-file_rec'
depends = 'denops.vim'
on_source = 'ddu.vim'


[[plugins]]
repo = 'Shougo/ddu-kind-file'
depends = 'denops.vim'
on_source = 'ddu.vim'

[[plugins]]
repo = 'shun/ddu-source-rg'
depends = 'denops.vim'
on_source = 'ddu.vim'

[[plugins]]
repo = 'Shougo/ddu-filter-matcher_substring'
depends = 'denops.vim'
on_source = 'ddu.vim'

[[plugins]]
repo = 'Shougo/ddu.vim'
depends = 'denops.vim'
on_event = 'CursorHold'
hook_add = '''
nnoremap <silent><leader>ff <cmd>call ddu#start({"name": "node-files", "sourceOptions": {"file_rec": {"path": getcwd()}}})<CR>
command! DduWholeFiles call ddu#start({"name": "whole-files", "sourceOptions": {"file_rec": {"path": getcwd()}}})
nnoremap <silent><leader>fw <Cmd>call ddu#start({
\   'sources':[
\     {'name': 'rg','options': {'matchers':[], "volatile": v:true,}}
\   ],
\ })<CR>
'''

hook_post_source = '''
" 全体に共通する設定を行う
call ddu#custom#patch_global({
    \     "ui": "ff",
    \     "uiParams": {
    \       "ff" : {
    \          "filterFloatingPosition" : "bottom",
    \          "filterSplitDirection" : "floating",
    \          "floatingBorder" : "rounded",
    \          "previewFloating" : v:true,
    \          "previewFloatingBorder" : "rounded",
    \          "previewFloatingTitle" : "preview",
    \          "previewSplit" : "horizontal",
    \          "prompt" : "> ",
    \          "split" : "floating",
    \          "startFilter" : v:true,
    \       }
    \     },
    \     "sourceOptions": {
    \         "_": {
    \             "matchers": ["matcher_substring"]
    \         }
    \     }
    \ })

" ddunodefilesで使用する設定を用意する
call ddu#custom#patch_local("node-files", {
    \     "sources":[{
    \        "name":"file_rec",
    \        "options": {"converters":["converter_devicon"],},
    \     }],
    \     "sourceParams": {
    \         "file_rec": {
    \             "ignoredDirectories": [".git", "node_modules"],
    \         }
    \     }
    \ })

" dduwholefilesで使用する設定を用意する
call ddu#custom#patch_local("whole-files", {
    \     "sources": ["file_rec"],
    \     "sourceParams": {
    \         "file_rec": {
    \             "ignoredDirectories": [],
    \         }
    \     },
    \     "sourceOptions": {
    \         "file_rec": {
    \             "maxItems": 50000
    \         }
    \     }
    \ })
call ddu#custom#patch_local("grep", {
\   'sourceParams' : {
\     'rg' : {
\       'args': ['--column',  '--color', '--no-hidden'],
\     },
\   },
\   'uiParams': {
\     'ff': {
\       'startFilter': v:false,
\     }
\   },
\ })


 function s:ddu_ff_filter_settings() abort
    nnoremap <buffer>e<cmd>call ddu#ui#do_action('itemAction', {'name': 'open'})<cr>
    nnoremap <buffer> <cr> <esc><cmd>close<cr>
    inoremap <buffer> <cr> <esc><cmd>close<cr>
    nnoremap <buffer> q <cmd>call ddu#ui#ff#do_action("quit")<cr>
 endfunction
 function s:ddu_ff_settings() abort
    nnoremap <buffer> q <cmd>call ddu#ui#ff#do_action("quit")<cr>
    nnoremap <buffer> <cr> <cmd>call ddu#ui#ff#do_action('itemAction',{'name': 'open'})<cr>
    nnoremap <buffer> i <cmd>call ddu#ui#ff#do_action("openFilterWindow")<cr>
    nnoremap <buffer> p <cmd>call ddu#ui#ff#do_action("togglePreview")<cr>
 endfunction
autocmd filetype ddu-ff call s:ddu_ff_settings()
autocmd filetype ddu-ff-filter call s:ddu_ff_filter_settings()
'''



